<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Mizuhiro Suzuki" />


<title>Replication of tables in Coate &amp; Ravallion (1993)</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Risk Sharing</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="RiskSharingLit.html">Literature</a>
</li>
<li>
  <a href="CR93_code.html">Coate and Ravallion (1993)</a>
</li>
<li>
  <a href="LTW_code.html">Ligon et al. (2002)</a>
</li>
<li>
  <a href="TW88_code.html">Thomas and Worrall (1988)</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Replication of tables in Coate &amp; Ravallion (1993)</h1>
<h4 class="author">Mizuhiro Suzuki</h4>
<h4 class="date">4/6/2020</h4>

</div>


<p>In this document, I replicate Tables 1, 2, and 3 in Coate &amp; Ravallion (1993). There is one very minor typo in the paper: the equation (5) should be <span class="math inline">\(\theta_{ij}^*(t + 1) = \min \{ \widehat{\theta}_{ij}, y_i - [y_i^{1 - \rho} - (v(\theta^*(t)) - \bar{v}) (1 - \rho) / r ]^{1 / (1 - \rho)} \}\)</span> instead of <span class="math inline">\(\theta_{ij}^*(t + 1) = \min \{ \widehat{\theta}_{ij}, y_i - [y_i^{1 - \rho} - (v(\theta^*(t)) - \bar{v}) / r ]^{1 / (1 - \rho)} \}\)</span>. This is fixed in the code below.</p>
<pre class="r"><code>rm(list = ls())
library(knitr)

# Common settings ------------------
y_vals &lt;- c(1, 2, 3)
theta_hat_vals &lt;- c((y_vals[2] - y_vals[1]) / 2, 
                    (y_vals[3] - y_vals[1]) / 2, 
                    (y_vals[3] - y_vals[2]) / 2)

# v(theta)
v_theta &lt;- function(theta, y_vals, pi, rho){
  output &lt;- 0
  for (i in 1:3){
    if (i &gt; 1){
      for (j in 1:(i-1)){
        output &lt;- output + pi[i,j] * ((y_vals[i] - theta[i+j-2]) ^ (1 - rho) / (1 - rho) + 
                                      (y_vals[j] + theta[i+j-2]) ^ (1 - rho) / (1 - rho))
      } 
    } else {
      output &lt;- output
    }
    output &lt;- output + pi[i, i] * (y_vals[i]) ^ (1 - rho) / (1 - rho) 
  }
  return(output)
}

# Iteration for theta_star
iteration &lt;- function(theta_star, theta_hat, y_val, y_vals, pi, rho, r, v_bar){
  new_theta_star_ij &lt;- min(theta_hat, 
                           y_val - (y_val ^ (1 - rho) - 
                                    (v_theta(theta_star, y_vals, pi, rho) - v_bar) 
                                    * (1 - rho) / r) ^ (1 / (1 - rho)))
  return(new_theta_star_ij)
}

# Iteration loop for theta_star
theta_star_loop &lt;- function(init_theta_star, theta_hat_vals, y_vals, pi, rho, r, v_bar){
  iter &lt;- 0
  tol &lt;- 1e-16
  error &lt;- tol + 1
  theta_star &lt;- init_theta_star
  new_theta_star &lt;- rep(0, 3)
  while (iter &lt; 500 &amp; error &gt; tol){
    new_theta_star[1] &lt;- iteration(theta_star, theta_hat_vals[1], 
                                   y_vals[2], y_vals, pi, rho, r, v_bar)
    new_theta_star[2] &lt;- iteration(theta_star, theta_hat_vals[2], 
                                   y_vals[3], y_vals, pi, rho, r, v_bar)
    new_theta_star[3] &lt;- iteration(theta_star, theta_hat_vals[3], 
                                   y_vals[3], y_vals, pi, rho, r, v_bar)
    error = max(abs(new_theta_star - theta_star))
    theta_star &lt;- new_theta_star
    iter &lt;- iter + 1
  }
  return(theta_star)
}</code></pre>
<div id="replication-of-table-1-the-highly-covariate-income-stream" class="section level2">
<h2>Replication of Table 1: The “highly covariate” income stream</h2>
<pre class="r"><code>table_1 &lt;- matrix(rep(0, (5 + 11 + 14) * 6), ncol = 6)

pi &lt;- matrix(c(0.2, 0.05, 0.05, 0.05, 0.3, 0.05, 0.05, 0.05, 0.2), nrow = 3) 
r_vals &lt;- c(0.05, 0.15, 0.25)
rho_vals &lt;- c(0.1, 0.3, 0.5, 0.7, 0.9, 1.1, 1.3, 1.5, 1.7, 1.9, 2.1, 2.3, 2.5, 2.7)

# r = 0.05
r &lt;- r_vals[1]
for (i in 1:5){
  # r
  table_1[i, 1] &lt;- r
  # rho
  table_1[i, 2] &lt;- rho_vals[i]
  # v_bar
  v_bar &lt;- 0
  for (j in 1:3){
    for (k in 1:3){
      v_bar &lt;- v_bar + pi[j,k] * (y_vals[j] ^ (1 - rho_vals[i]) / (1 - rho_vals[i]))
    }
  }
  # theta_star iteration
  init_theta_star &lt;- theta_hat_vals
  theta_star &lt;- theta_star_loop(init_theta_star, theta_hat_vals, 
                                y_vals, pi, rho_vals[i], r, v_bar)
  # theta_star_21
  table_1[i, 3] &lt;- theta_star[1]
  # theta_star_31
  table_1[i, 4] &lt;- theta_star[2]
  # theta_star_32
  table_1[i, 5] &lt;- theta_star[3]
  # gamma
  table_1[i, 6] &lt;- (v_theta(theta_star, y_vals, pi, rho_vals[i]) - v_bar) / 
                   (v_theta(theta_hat_vals, y_vals, pi, rho_vals[i]) - v_bar)
}

# r = 0.15
r &lt;- r_vals[2]
for (i in 1:11){
  # r
  table_1[i+5, 1] &lt;- r
  # rho
  table_1[i+5, 2] &lt;- rho_vals[i]
  # v_bar
  v_bar &lt;- 0
  for (j in 1:3){
    for (k in 1:3){
      v_bar &lt;- v_bar + pi[j,k] * (y_vals[j] ^ (1 - rho_vals[i]) / (1 - rho_vals[i]))
    }
  }
  # theta_star iteration
  init_theta_star &lt;- theta_hat_vals
  theta_star &lt;- theta_star_loop(init_theta_star, theta_hat_vals, 
                                y_vals, pi, rho_vals[i], r, v_bar)
  # theta_star_21
  table_1[i+5, 3] &lt;- theta_star[1]
  # theta_star_31
  table_1[i+5, 4] &lt;- theta_star[2]
  # theta_star_32
  table_1[i+5, 5] &lt;- theta_star[3]
  # gamma
  table_1[i+5, 6] &lt;- (v_theta(theta_star, y_vals, pi, rho_vals[i]) - v_bar) / 
                     (v_theta(theta_hat_vals, y_vals, pi, rho_vals[i]) - v_bar)
}

# r = 0.25
r &lt;- r_vals[3]
for (i in 1:14){
  # r
  table_1[i+16, 1] &lt;- r
  # rho
  table_1[i+16, 2] &lt;- rho_vals[i]
  # v_bar
  v_bar &lt;- 0
  for (j in 1:3){
    for (k in 1:3){
      v_bar &lt;- v_bar + pi[j,k] * (y_vals[j] ^ (1 - rho_vals[i]) / (1 - rho_vals[i]))
    }
  }
  # theta_star iteration
  init_theta_star &lt;- theta_hat_vals
  theta_star &lt;- theta_star_loop(init_theta_star, theta_hat_vals, 
                                y_vals, pi, rho_vals[i], r, v_bar)
  # theta_star_21
  table_1[i+16, 3] &lt;- theta_star[1]
  # theta_star_31
  table_1[i+16, 4] &lt;- theta_star[2]
  # theta_star_32
  table_1[i+16, 5] &lt;- theta_star[3]
  # gamma
  table_1[i+16, 6] &lt;- (v_theta(theta_star, y_vals, pi, rho_vals[i]) - v_bar) / 
                      (v_theta(theta_hat_vals, y_vals, pi, rho_vals[i]) - v_bar)
}

colnames(table_1) &lt;- c(&quot;$r$&quot;, &quot;$\\rho$&quot;, &quot;$\\theta_{21}^*$&quot;, 
                       &quot;$\\theta_{31}^*$&quot;, &quot;$\\theta_{32}^*$&quot;, &quot;$\\gamma$&quot;)
kable(table_1, digits = 3, caption = &quot;Highly covariate income streams&quot;)</code></pre>
<table>
<caption>Highly covariate income streams</caption>
<thead>
<tr class="header">
<th align="right"><span class="math inline">\(r\)</span></th>
<th align="right"><span class="math inline">\(\rho\)</span></th>
<th align="right"><span class="math inline">\(\theta_{21}^*\)</span></th>
<th align="right"><span class="math inline">\(\theta_{31}^*\)</span></th>
<th align="right"><span class="math inline">\(\theta_{32}^*\)</span></th>
<th align="right"><span class="math inline">\(\gamma\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.05</td>
<td align="right">0.1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.05</td>
<td align="right">0.3</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.05</td>
<td align="right">0.5</td>
<td align="right">0.262</td>
<td align="right">0.323</td>
<td align="right">0.323</td>
<td align="right">0.649</td>
</tr>
<tr class="even">
<td align="right">0.05</td>
<td align="right">0.7</td>
<td align="right">0.500</td>
<td align="right">0.686</td>
<td align="right">0.500</td>
<td align="right">0.942</td>
</tr>
<tr class="odd">
<td align="right">0.05</td>
<td align="right">0.9</td>
<td align="right">0.500</td>
<td align="right">0.963</td>
<td align="right">0.500</td>
<td align="right">0.999</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">0.1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.15</td>
<td align="right">0.3</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">0.5</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.15</td>
<td align="right">0.7</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">0.9</td>
<td align="right">0.001</td>
<td align="right">0.001</td>
<td align="right">0.001</td>
<td align="right">0.003</td>
</tr>
<tr class="odd">
<td align="right">0.15</td>
<td align="right">1.1</td>
<td align="right">0.179</td>
<td align="right">0.279</td>
<td align="right">0.279</td>
<td align="right">0.568</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">1.3</td>
<td align="right">0.299</td>
<td align="right">0.500</td>
<td align="right">0.500</td>
<td align="right">0.819</td>
</tr>
<tr class="odd">
<td align="right">0.15</td>
<td align="right">1.5</td>
<td align="right">0.386</td>
<td align="right">0.685</td>
<td align="right">0.500</td>
<td align="right">0.934</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">1.7</td>
<td align="right">0.452</td>
<td align="right">0.846</td>
<td align="right">0.500</td>
<td align="right">0.986</td>
</tr>
<tr class="odd">
<td align="right">0.15</td>
<td align="right">1.9</td>
<td align="right">0.500</td>
<td align="right">0.982</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">2.1</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">0.1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">0.3</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">0.5</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">0.7</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">0.9</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">1.1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">1.3</td>
<td align="right">0.034</td>
<td align="right">0.057</td>
<td align="right">0.057</td>
<td align="right">0.140</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">1.5</td>
<td align="right">0.149</td>
<td align="right">0.270</td>
<td align="right">0.270</td>
<td align="right">0.543</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">1.7</td>
<td align="right">0.234</td>
<td align="right">0.451</td>
<td align="right">0.451</td>
<td align="right">0.761</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">1.9</td>
<td align="right">0.299</td>
<td align="right">0.608</td>
<td align="right">0.500</td>
<td align="right">0.879</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">2.1</td>
<td align="right">0.353</td>
<td align="right">0.750</td>
<td align="right">0.500</td>
<td align="right">0.946</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">2.3</td>
<td align="right">0.398</td>
<td align="right">0.875</td>
<td align="right">0.500</td>
<td align="right">0.981</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">2.5</td>
<td align="right">0.435</td>
<td align="right">0.985</td>
<td align="right">0.500</td>
<td align="right">0.995</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">2.7</td>
<td align="right">0.468</td>
<td align="right">1.000</td>
<td align="right">0.500</td>
<td align="right">0.999</td>
</tr>
</tbody>
</table>
</div>
<div id="replication-of-table-2-the-moderately-covariate-income-stream" class="section level2">
<h2>Replication of Table 2: The “moderately covariate” income stream</h2>
<pre class="r"><code>table_2 &lt;- matrix(rep(0, (5 + 7 + 9) * 6), ncol = 6)

pi &lt;- matrix(c(0.1, 0.1, 0.1, 0.1, 0.2, 0.1, 0.1, 0.1, 0.1), nrow = 3) 
r_vals &lt;- c(0.05, 0.15, 0.25)
rho_vals &lt;- c(0.1, 0.3, 0.5, 0.7, 0.9, 1.1, 1.3, 1.5, 1.7, 1.9, 2.1, 2.3, 2.5, 2.7)

# r = 0.05
r &lt;- r_vals[1]
for (i in 1:5){
  # r
  table_2[i, 1] &lt;- r
  # rho
  table_2[i, 2] &lt;- rho_vals[i]
  # v_bar
  v_bar &lt;- 0
  for (j in 1:3){
    for (k in 1:3){
      v_bar &lt;- v_bar + pi[j,k] * (y_vals[j] ^ (1 - rho_vals[i]) / (1 - rho_vals[i]))
    }
  }
  # theta_star iteration
  init_theta_star &lt;- theta_hat_vals
  theta_star &lt;- theta_star_loop(init_theta_star, theta_hat_vals, 
                                y_vals, pi, rho_vals[i], r, v_bar)
  # theta_star_21
  table_2[i, 3] &lt;- theta_star[1]
  # theta_star_31
  table_2[i, 4] &lt;- theta_star[2]
  # theta_star_32
  table_2[i, 5] &lt;- theta_star[3]
  # gamma
  table_2[i, 6] &lt;- (v_theta(theta_star, y_vals, pi, rho_vals[i]) - v_bar) / 
                   (v_theta(theta_hat_vals, y_vals, pi, rho_vals[i]) - v_bar)
}

# r = 0.15
r &lt;- r_vals[2]
for (i in 1:7){
  # r
  table_2[i+5, 1] &lt;- r
  # rho
  table_2[i+5, 2] &lt;- rho_vals[i]
  # v_bar
  v_bar &lt;- 0
  for (j in 1:3){
    for (k in 1:3){
      v_bar &lt;- v_bar + pi[j,k] * (y_vals[j] ^ (1 - rho_vals[i]) / (1 - rho_vals[i]))
    }
  }
  # theta_star iteration
  init_theta_star &lt;- theta_hat_vals
  theta_star &lt;- theta_star_loop(init_theta_star, theta_hat_vals, 
                                y_vals, pi, rho_vals[i], r, v_bar)
  # theta_star_21
  table_2[i+5, 3] &lt;- theta_star[1]
  # theta_star_31
  table_2[i+5, 4] &lt;- theta_star[2]
  # theta_star_32
  table_2[i+5, 5] &lt;- theta_star[3]
  # gamma
  table_2[i+5, 6] &lt;- (v_theta(theta_star, y_vals, pi, rho_vals[i]) - v_bar) / 
                     (v_theta(theta_hat_vals, y_vals, pi, rho_vals[i]) - v_bar)
}

# r = 0.25
r &lt;- r_vals[3]
for (i in 1:9){
  # r
  table_2[i+12, 1] &lt;- r
  # rho
  table_2[i+12, 2] &lt;- rho_vals[i]
  # v_bar
  v_bar &lt;- 0
  for (j in 1:3){
    for (k in 1:3){
      v_bar &lt;- v_bar + pi[j,k] * (y_vals[j] ^ (1 - rho_vals[i]) / (1 - rho_vals[i]))
    }
  }
  # theta_star iteration
  init_theta_star &lt;- theta_hat_vals
  theta_star &lt;- theta_star_loop(init_theta_star, theta_hat_vals, 
                                y_vals, pi, rho_vals[i], r, v_bar)
  # theta_star_21
  table_2[i+12, 3] &lt;- theta_star[1]
  # theta_star_31
  table_2[i+12, 4] &lt;- theta_star[2]
  # theta_star_32
  table_2[i+12, 5] &lt;- theta_star[3]
  # gamma
  table_2[i+12, 6] &lt;- (v_theta(theta_star, y_vals, pi, rho_vals[i]) - v_bar) / 
                      (v_theta(theta_hat_vals, y_vals, pi, rho_vals[i]) - v_bar)
}

colnames(table_2) &lt;- c(&quot;$r$&quot;, &quot;$\\rho$&quot;, &quot;$\\theta_{21}^*$&quot;, 
                       &quot;$\\theta_{31}^*$&quot;, &quot;$\\theta_{32}^*$&quot;, &quot;$\\gamma$&quot;)
kable(table_2, digits = 3, caption = &quot;Moderately covariate income streams&quot;)</code></pre>
<table>
<caption>Moderately covariate income streams</caption>
<thead>
<tr class="header">
<th align="right"><span class="math inline">\(r\)</span></th>
<th align="right"><span class="math inline">\(\rho\)</span></th>
<th align="right"><span class="math inline">\(\theta_{21}^*\)</span></th>
<th align="right"><span class="math inline">\(\theta_{31}^*\)</span></th>
<th align="right"><span class="math inline">\(\theta_{32}^*\)</span></th>
<th align="right"><span class="math inline">\(\gamma\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.05</td>
<td align="right">0.1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.05</td>
<td align="right">0.3</td>
<td align="right">0.365</td>
<td align="right">0.415</td>
<td align="right">0.415</td>
<td align="right">0.766</td>
</tr>
<tr class="odd">
<td align="right">0.05</td>
<td align="right">0.5</td>
<td align="right">0.500</td>
<td align="right">0.934</td>
<td align="right">0.500</td>
<td align="right">0.997</td>
</tr>
<tr class="even">
<td align="right">0.05</td>
<td align="right">0.7</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
</tr>
<tr class="odd">
<td align="right">0.05</td>
<td align="right">0.9</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">0.1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.15</td>
<td align="right">0.3</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">0.5</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.15</td>
<td align="right">0.7</td>
<td align="right">0.253</td>
<td align="right">0.338</td>
<td align="right">0.338</td>
<td align="right">0.663</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">0.9</td>
<td align="right">0.434</td>
<td align="right">0.628</td>
<td align="right">0.500</td>
<td align="right">0.916</td>
</tr>
<tr class="odd">
<td align="right">0.15</td>
<td align="right">1.1</td>
<td align="right">0.500</td>
<td align="right">0.857</td>
<td align="right">0.500</td>
<td align="right">0.989</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">1.3</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">0.1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">0.3</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">0.5</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">0.7</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">0.9</td>
<td align="right">0.122</td>
<td align="right">0.176</td>
<td align="right">0.176</td>
<td align="right">0.397</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">1.1</td>
<td align="right">0.282</td>
<td align="right">0.440</td>
<td align="right">0.440</td>
<td align="right">0.769</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">1.3</td>
<td align="right">0.390</td>
<td align="right">0.649</td>
<td align="right">0.500</td>
<td align="right">0.920</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">1.5</td>
<td align="right">0.469</td>
<td align="right">0.827</td>
<td align="right">0.500</td>
<td align="right">0.983</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">1.7</td>
<td align="right">0.500</td>
<td align="right">0.977</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
</tr>
</tbody>
</table>
</div>
<div id="replication-of-table-3-the-highly-non-covariate-income-stream" class="section level2">
<h2>Replication of Table 3: The “highly non-covariate” income stream</h2>
<pre class="r"><code>table_3 &lt;- matrix(rep(0, (5 + 6 + 8) * 6), ncol = 6)

pi &lt;- matrix(c(0.1, 0.1, 0.1, 0.1, 0.2, 0.1, 0.1, 0.1, 0.1), nrow = 3) 
r_vals &lt;- c(0.05, 0.15, 0.25)
rho_vals &lt;- c(0.1, 0.3, 0.5, 0.7, 0.9, 1.1, 1.3, 1.5, 1.7, 1.9, 2.1, 2.3, 2.5, 2.7)

# r = 0.05
r &lt;- r_vals[1]
for (i in 1:5){
  # r
  table_3[i, 1] &lt;- r
  # rho
  table_3[i, 2] &lt;- rho_vals[i]
  # v_bar
  v_bar &lt;- 0
  for (j in 1:3){
    for (k in 1:3){
      v_bar &lt;- v_bar + pi[j,k] * (y_vals[j] ^ (1 - rho_vals[i]) / (1 - rho_vals[i]))
    }
  }
  # theta_star iteration
  init_theta_star &lt;- theta_hat_vals
  theta_star &lt;- theta_star_loop(init_theta_star, theta_hat_vals, 
                                y_vals, pi, rho_vals[i], r, v_bar)
  # theta_star_21
  table_3[i, 3] &lt;- theta_star[1]
  # theta_star_31
  table_3[i, 4] &lt;- theta_star[2]
  # theta_star_32
  table_3[i, 5] &lt;- theta_star[3]
  # gamma
  table_3[i, 6] &lt;- (v_theta(theta_star, y_vals, pi, rho_vals[i]) - v_bar) / 
                   (v_theta(theta_hat_vals, y_vals, pi, rho_vals[i]) - v_bar)
}

# r = 0.15
r &lt;- r_vals[2]
for (i in 1:6){
  # r
  table_3[i+5, 1] &lt;- r
  # rho
  table_3[i+5, 2] &lt;- rho_vals[i]
  # v_bar
  v_bar &lt;- 0
  for (j in 1:3){
    for (k in 1:3){
      v_bar &lt;- v_bar + pi[j,k] * (y_vals[j] ^ (1 - rho_vals[i]) / (1 - rho_vals[i]))
    }
  }
  # theta_star iteration
  init_theta_star &lt;- theta_hat_vals
  theta_star &lt;- theta_star_loop(init_theta_star, theta_hat_vals, 
                                y_vals, pi, rho_vals[i], r, v_bar)
  # theta_star_21
  table_3[i+5, 3] &lt;- theta_star[1]
  # theta_star_31
  table_3[i+5, 4] &lt;- theta_star[2]
  # theta_star_32
  table_3[i+5, 5] &lt;- theta_star[3]
  # gamma
  table_3[i+5, 6] &lt;- (v_theta(theta_star, y_vals, pi, rho_vals[i]) - v_bar) / 
                     (v_theta(theta_hat_vals, y_vals, pi, rho_vals[i]) - v_bar)
}

# r = 0.25
r &lt;- r_vals[3]
for (i in 1:8){
  # r
  table_3[i+11, 1] &lt;- r
  # rho
  table_3[i+11, 2] &lt;- rho_vals[i]
  # v_bar
  v_bar &lt;- 0
  for (j in 1:3){
    for (k in 1:3){
      v_bar &lt;- v_bar + pi[j,k] * (y_vals[j] ^ (1 - rho_vals[i]) / (1 - rho_vals[i]))
    }
  }
  # theta_star iteration
  init_theta_star &lt;- theta_hat_vals
  theta_star &lt;- theta_star_loop(init_theta_star, theta_hat_vals, 
                                y_vals, pi, rho_vals[i], r, v_bar)
  # theta_star_21
  table_3[i+11, 3] &lt;- theta_star[1]
  # theta_star_31
  table_3[i+11, 4] &lt;- theta_star[2]
  # theta_star_32
  table_3[i+11, 5] &lt;- theta_star[3]
  # gamma
  table_3[i+11, 6] &lt;- (v_theta(theta_star, y_vals, pi, rho_vals[i]) - v_bar) / 
                      (v_theta(theta_hat_vals, y_vals, pi, rho_vals[i]) - v_bar)

}

colnames(table_3) &lt;- c(&quot;$r$&quot;, &quot;$\\rho$&quot;, &quot;$\\theta_{21}^*$&quot;, 
                       &quot;$\\theta_{31}^*$&quot;, &quot;$\\theta_{32}^*$&quot;, &quot;$\\gamma$&quot;)
kable(table_3, digits = 3, caption = &quot;Highly non-covariate income streams&quot;)</code></pre>
<table>
<caption>Highly non-covariate income streams</caption>
<thead>
<tr class="header">
<th align="right"><span class="math inline">\(r\)</span></th>
<th align="right"><span class="math inline">\(\rho\)</span></th>
<th align="right"><span class="math inline">\(\theta_{21}^*\)</span></th>
<th align="right"><span class="math inline">\(\theta_{31}^*\)</span></th>
<th align="right"><span class="math inline">\(\theta_{32}^*\)</span></th>
<th align="right"><span class="math inline">\(\gamma\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.05</td>
<td align="right">0.1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.05</td>
<td align="right">0.3</td>
<td align="right">0.365</td>
<td align="right">0.415</td>
<td align="right">0.415</td>
<td align="right">0.766</td>
</tr>
<tr class="odd">
<td align="right">0.05</td>
<td align="right">0.5</td>
<td align="right">0.500</td>
<td align="right">0.934</td>
<td align="right">0.500</td>
<td align="right">0.997</td>
</tr>
<tr class="even">
<td align="right">0.05</td>
<td align="right">0.7</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
</tr>
<tr class="odd">
<td align="right">0.05</td>
<td align="right">0.9</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
<td align="right">0.500</td>
<td align="right">1.000</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">0.1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.15</td>
<td align="right">0.3</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">0.5</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.15</td>
<td align="right">0.7</td>
<td align="right">0.253</td>
<td align="right">0.338</td>
<td align="right">0.338</td>
<td align="right">0.663</td>
</tr>
<tr class="even">
<td align="right">0.15</td>
<td align="right">0.9</td>
<td align="right">0.434</td>
<td align="right">0.628</td>
<td align="right">0.500</td>
<td align="right">0.916</td>
</tr>
<tr class="odd">
<td align="right">0.15</td>
<td align="right">1.1</td>
<td align="right">0.500</td>
<td align="right">0.857</td>
<td align="right">0.500</td>
<td align="right">0.989</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">0.1</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">0.3</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">0.5</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">0.7</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">0.9</td>
<td align="right">0.122</td>
<td align="right">0.176</td>
<td align="right">0.176</td>
<td align="right">0.397</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">1.1</td>
<td align="right">0.282</td>
<td align="right">0.440</td>
<td align="right">0.440</td>
<td align="right">0.769</td>
</tr>
<tr class="even">
<td align="right">0.25</td>
<td align="right">1.3</td>
<td align="right">0.390</td>
<td align="right">0.649</td>
<td align="right">0.500</td>
<td align="right">0.920</td>
</tr>
<tr class="odd">
<td align="right">0.25</td>
<td align="right">1.5</td>
<td align="right">0.469</td>
<td align="right">0.827</td>
<td align="right">0.500</td>
<td align="right">0.983</td>
</tr>
</tbody>
</table>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
